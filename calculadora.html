<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadoras de Gestão de Apostas</title>
    <style>
        body {font-family: "Times New Roman", serif; background-color: #07251F; color: #EAF9E1; margin: 10px; padding: 10px;}
        h2, h3 {text-align: center;}
        label, input, select, button, .resultado {font-family: "Times New Roman", serif; display: block; width: 100%; max-width: 100%; margin: 10px 0; padding: 10px; border-radius: 12px; box-sizing: border-box; font-size: 16px;}
        input, select {background-color: #EAF9E1; color: #07251F; border: 1px solid #07251F;}
        button {background-color: #d4af37; color: #07251F; border: none; font-weight: bold; cursor: pointer; width: auto; display: inline-block; margin-right: 10px; margin-top: 20px;}
        button:hover {opacity: 0.9;}
        .resultado {background-color: #103a2f; color: #EAF9E1; display: none; white-space: pre-wrap; padding: 15px; border: 1px solid #d4af37; margin-top: 10px; line-height: 1.6;}
        .botoes-container {display: flex; gap: 10px; margin-top: 10px; margin-bottom: 10px; flex-wrap: wrap;}
        fieldset {border: 1px solid #2a5a4a; border-radius: 8px; padding: 10px 15px; margin-top: 15px; max-width: 600px; margin-left:auto; margin-right:auto;}
        legend {padding: 0 10px; font-weight: bold; color: #d4af37;}
        .dutch-grid {display: grid; grid-template-columns: 1fr 1fr; gap: 15px;}
        @media (max-width: 600px) {
            .dutch-grid {grid-template-columns: 1fr;}
        }
    </style>
</head>
<body>

    <h2 style="color: #d4af37;">Calculadoras de Gestão de Apostas</h2>

    <fieldset>
        <legend>Calculadora de Unidade (Critério de Kelly)</legend>
        <label for="kelly_banca">Valor Total da Banca (R$)</label><input type="text" id="kelly_banca" placeholder="Ex: 1000"/>
        <label for="kelly_odd">Odd</label><input type="text" id="kelly_odd" placeholder="Ex: 2.5"/>
        <label for="kelly_prob">Probabilidade Justa (%)</label><input type="text" id="kelly_prob" placeholder="Ex: 45"/>
        <label for="kelly_fator">Fator de Risco (Kelly Fracionado)</label>
        <select id="kelly_fator">
            <option value="1">Full Kelly (Risco Máximo)</option>
            <option value="0.5" selected>Half Kelly (Recomendado)</option>
            <option value="0.25">Quarter Kelly (Conservador)</option>
        </select>
        <button onclick="calcularKelly()">Calcular Unidade</button>
        <div class="resultado" id="resultado_kelly"></div>
    </fieldset>

    <fieldset>
        <legend>Calculadora de Cobertura (Hedge)</legend>
        <label for="hedge_valor1">Valor da 1ª Aposta</label><input type="text" id="hedge_valor1"/>
        <label for="hedge_odd1">1ª Odd</label><input type="text" id="hedge_odd1"/>
        <label for="hedge_odd2">2ª Odd (Odd de Cobertura)</label><input type="text" id="hedge_odd2"/>
        <label for="hedge_valor2">Valor da 2ª Aposta (opcional)</label><input type="text" id="hedge_valor2" placeholder="Deixe em branco para calcular"/>
        <div class="botoes-container">
            <button onclick="calcularHedge()">Calcular Cobertura</button>
            <button onclick="fecharPosicao()">Fechar Posição (Lucro Igual)</button>
        </div>
        <div class="resultado" id="resultado_hedge"></div>
    </fieldset>

    <fieldset>
        <legend>Calculadora de Dutching (Dividir Stake Total)</legend>
        <label for="dutch_total_valor">Valor Total a ser Apostado</label><input type="text" id="dutch_total_valor"/>
        <div class="dutch-grid">
            <div><label>1ª Odd</label><input type="text" id="dutch_total_odd1" /></div>
            <div><label>2ª Odd</label><input type="text" id="dutch_total_odd2" /></div>
            <div><label>3ª Odd</label><input type="text" id="dutch_total_odd3" /></div>
            <div><label>4ª Odd</label><input type="text" id="dutch_total_odd4" /></div>
        </div>
        <button onclick="calcularDutchingPorTotal()">Calcular Dutching</button>
        <div class="resultado" id="resultado_dutching_total"></div>
    </fieldset>

<script>
'use strict';

// Funções auxiliares
const parseInput = (id) => {
    const el = document.getElementById(id);
    if (!el || el.value.trim() === '') return NaN;
    return parseFloat(String(el.value).replace(',', '.'));
};

const formatOutput = (n, dec = 2) => {
    if (isNaN(n) || n === null || !isFinite(n)) return 'N/A';
    return n.toFixed(dec).replace('.', ',');
};

// Funções das calculadoras
function calcularKelly() {
    const banca = parseInput('kelly_banca');
    const odd = parseInput('kelly_odd');
    const prob = parseInput('kelly_prob') / 100;
    const fator = parseInput('kelly_fator');
    const resultadoDiv = document.getElementById('resultado_kelly');

    if (isNaN(banca) || isNaN(odd) || isNaN(prob) || isNaN(fator)) {
        alert('Preencha todos os campos da Calculadora de Unidade.');
        return;
    }
    
    if (prob * odd <= 1) {
        resultadoDiv.innerText = `EV Negativo ou Nulo. Não apostar.\n(Probabilidade * Odd = ${formatOutput(prob*odd, 3)})`;
        resultadoDiv.style.display = 'block';
        return;
    }

    const kellyFraction = (prob * odd - 1) / (odd - 1);
    const stake = banca * kellyFraction * fator;

    resultadoDiv.innerText = `Fração de Kelly: ${formatOutput(kellyFraction * 100, 2)}%\nUnidade Sugerida: R$ ${formatOutput(stake, 2)}`;
    resultadoDiv.style.display = 'block';
}

function calcularHedge(isFechamento = false) {
    const v1 = parseInput('hedge_valor1');
    const o1 = parseInput('hedge_odd1');
    const o2 = parseInput('hedge_odd2');
    const resultadoDiv = document.getElementById('resultado_hedge');

    if (isNaN(v1) || isNaN(o1) || isNaN(o2)) {
        alert('Preencha o valor da 1ª aposta e as duas odds.');
        return;
    }

    const retornoPotencial1 = v1 * o1;
    let v2;

    if(isFechamento) {
        v2 = retornoPotencial1 / o2;
    } else {
        const v2Input = parseInput('hedge_valor2');
        v2 = isNaN(v2Input) ? retornoPotencial1 / o2 : v2Input;
    }
    
    document.getElementById('hedge_valor2').value = formatOutput(v2, 2);

    const totalInvestido = v1 + v2;
    const retorno2 = v2 * o2;
    const lucro1 = retornoPotencial1 - totalInvestido;
    const lucro2 = retorno2 - totalInvestido;

    let resultadoTexto = `Para cobrir, aposte: R$ ${formatOutput(v2, 2)} na Odd de ${formatOutput(o2, 2)}\n\n`;
    resultadoTexto += `Cenários:\n`;
    resultadoTexto += `  - Se Aposta 1 vencer: Lucro de R$ ${formatOutput(lucro1, 2)}\n`;
    resultadoTexto += `  - Se Aposta 2 vencer: Lucro de R$ ${formatOutput(lucro2, 2)}\n`;
    resultadoTexto += `Total Investido: R$ ${formatOutput(totalInvestido, 2)}`;

    resultadoDiv.innerText = resultadoTexto;
    resultadoDiv.style.display = 'block';
}

function fecharPosicao() {
    calcularHedge(true);
}

function calcularDutchingPorTotal() {
    const totalStake = parseInput('dutch_total_valor');
    const resultadoDiv = document.getElementById('resultado_dutching_total');
    if(isNaN(totalStake)){
        alert('Preencha o Valor Total a ser Apostado.'); return;
    }
    
    const odds = [
        parseInput('dutch_total_odd1'),
        parseInput('dutch_total_odd2'),
        parseInput('dutch_total_odd3'),
        parseInput('dutch_total_odd4')
    ].filter(o => !isNaN(o) && o > 1);

    if (odds.length < 2) {
        alert('Forneça pelo menos duas odds válidas.'); return;
    }

    const impliedProbs = odds.map(o => 1 / o);
    const totalImpliedProb = impliedProbs.reduce((sum, p) => sum + p, 0);
    
    if (totalImpliedProb >= 1) {
         resultadoDiv.innerText = `As odds fornecidas resultam em prejuízo garantido.\n(Probabilidade Implícita Total: ${formatOutput(totalImpliedProb * 100, 2)}%)`;
         resultadoDiv.style.display = 'block';
         return;
    }

    let resultadoTexto = 'Distribuição das Apostas:\n';
    let retornoPotencial = 0;
    
    odds.forEach((odd, index) => {
        const impliedProb = 1 / odd;
        const stake = totalStake * (impliedProb / totalImpliedProb);
        retornoPotencial = stake * odd; // Será o mesmo para todas as apostas
        resultadoTexto += `  - Aposta ${index + 1} (Odd ${formatOutput(odd, 2)}): R$ ${formatOutput(stake, 2)}\n`;
    });
    
    const lucro = retornoPotencial - totalStake;
    
    resultadoTexto += `\nRetorno Potencial: R$ ${formatOutput(retornoPotencial, 2)}`;
    resultadoTexto += `\nLucro: R$ ${formatOutput(lucro, 2)} (${formatOutput((lucro / totalStake) * 100, 2)}%)`;
    
    resultadoDiv.innerText = resultadoTexto;
    resultadoDiv.style.display = 'block';
}

</script>
</body>
</html>
