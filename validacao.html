<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validação de Operação</title>
    <style>
        body { font-family: "Times New Roman", serif; background-color: #07251F; color: #EAF9E1; margin: 0; padding: 20px; line-height: 1.6; }
        .form-container { background-color: #103a2f; padding: 20px 30px; border-radius: 12px; border: 1px solid #d4af37; width: 100%; max-width: 750px; margin: 20px auto; }
        h2 { text-align: center; color: #d4af37; font-size: 24px; margin-bottom:25px;}
        .form-group { margin-bottom: 18px; }
        .form-group label, .fieldset-legend-main, .question-title { display: block; font-weight: bold; color: #EAF9E1; margin-bottom: 7px; font-size: 17px; }
        .fieldset-legend-main { padding: 0 10px; color: #d4af37; font-size: 19px;}
        .form-group input[type="text"], .form-group input[type="datetime-local"], .form-group input[type="number"], .form-group input[type="file"], .form-group select, .form-group textarea { width: 100%; padding: 10px; border-radius: 8px; box-sizing: border-box; font-size: 15px; font-family: "Times New Roman", serif; background-color: #EAF9E1; color: #07251F; border: 1px solid #2a5a4a; }
        .dynamic-input { margin-top: 8px; } 
        .main-fieldset { border: 1px solid #2a5a4a; border-radius: 8px; padding: 12px 20px; margin-bottom: 22px; }
        .sub-group { margin-bottom: 18px; border-bottom: 1px dashed #2a5a4a; padding-bottom: 18px; }
        .sub-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .options-container { display: flex; flex-wrap: wrap; gap: 8px 18px; align-items: center; }
        .option-item { display: flex; align-items: center; margin-bottom: 5px;}
        .option-item input[type="radio"], .option-item input[type="checkbox"] { margin-right: 8px; cursor: pointer; width: 17px; height: 17px; flex-shrink: 0;}
        .option-item label { color: #EAF9E1; font-weight: normal; cursor: pointer; margin-bottom: 0; font-size: 15px; }
        .submit-button { background-color: #d4af37; color: #07251F; border: none; font-weight: bold; cursor: pointer; display: inline-block; margin-top: 20px; padding: 10px 22px; border-radius: 8px; font-size: 17px; font-family: "Times New Roman", serif; }
        
        #mensagemStatus { display: none; padding: 20px; margin-top: 20px; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold; }
        .sucesso { background-color: #dff0d8; color: #3c763d; border: 1px solid #d6e9c6; }
        .erro { background-color: #f2dede; color: #a94442; border: 1px solid #ebccd1; }

        #prognosticos-container {
            border: 1px solid #2a5a4a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        .prognostico-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed #2a5a4a;
            flex-wrap: wrap; 
        }
        .prognostico-item:last-child {
            border-bottom: none;
        }
        .prognostico-site-name { 
            font-weight: bold;
            color: #EAF9E1;
            flex-basis: 40%;
            text-align: left;
            margin-bottom: 5px; 
            margin-right: 10px;
        }
        .prognostico-site-name-input {
            padding: 8px;
            border-radius: 6px;
            font-family: "Times New Roman", serif;
            background-color: #EAF9E1;
            color: #07251F;
            border: 1px solid #2a5a4a;
            box-sizing: border-box;
            font-size: 15px;
            font-weight: normal; 
            flex-basis: 40%; 
            margin-right: 10px; 
            margin-bottom: 5px;
        }

        .prognostico-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-start; 
            flex-grow: 1; 
        }
        .prognostico-options .option-item label {
            font-size: 14px;
        }
        .prognostico-group-separator {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #d4af37;
        }


        @media (max-width: 700px) { 
            .prognostico-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .prognostico-site-name,
            .prognostico-site-name-input { 
                flex-basis: 100%; 
                margin-bottom: 10px;
                margin-right: 0; 
            }
            .prognostico-options {
                justify-content: flex-start;
                width: 100%; 
            }
             .prognostico-options .option-item {
                margin-bottom: 8px; 
            }
        }

        @media (max-width: 600px) {
            body { padding: 10px; margin:10px;}
            .form-container { padding: 15px; }
            h2 { font-size: 20px; }
            .form-group label, .fieldset-legend-main, .question-title { font-size: 15px; }
            .fieldset-legend-main {font-size: 17px;}
            .form-group input, .form-group select, .form-group textarea { padding: 9px; font-size: 14px; }
            .options-container { flex-direction: column; align-items: flex-start; gap: 6px; }
            .submit-button{padding: 9px 16px; font-size:15px;}
        }
    </style>
</head>
<body>
    <div class="form-container">
        <form id="validacaoForm" action="https://script.google.com/macros/s/AKfycbzMohuS0VcT2_f5f-gU4h-8-ADFknbYvvdlODFNyKIWhSzgYVTYM8drqOhJZodiSQRB/exec" method="post">
            <input type="hidden" name="form_type" value="validacao">
            <h2>Validação de Operação</h2>
            
            <div class="form-group">
                <label for="validacao_datetime">Data e Horário da Validação</label>
                <input type="datetime-local" id="validacao_datetime" name="validacao_datetime" required>
            </div>

            <div class="form-group">
                <label for="referencia_realizacao_select">Referência da Operação Original</label>
                <select id="referencia_realizacao_select" name="referencia_realizacao_select" required>
                    <option value="" disabled selected></option>
                    <option value="outro_referencia_realizacao">Outro</option>
                </select>
                <input type="text" id="outra_referencia_realizacao_input" name="outra_referencia_realizacao_input" class="dynamic-input" style="display: none;">
            </div>

            <div class="form-group">
                <label for="retorno_pretendido">Odd Pretendida</label>
                <input type="number" id="retorno_pretendido" name="retorno_pretendido" step="0.01" required>
            </div>

            <div class="form-group">
                <label for="estrategia_select_val">Estratégia</label>
                <select id="estrategia_select_val" name="estrategia_select_val" required>
                    <option value="" disabled selected></option>
                    <option value="outro_estrategia_val">Outro</option>
                </select>
                <input type="text" id="outra_estrategia_val_input" name="outra_estrategia_val_input" class="dynamic-input" style="display: none;">
            </div>

            <div class="form-group">
                <label for="esporte_select_val">Esporte</label>
                <select id="esporte_select_val" name="esporte_select_val" required>
                     <option value="" disabled selected></option>
                     <option value="outro_esporte_val">Outro</option>
                </select>
                <input type="text" id="outro_esporte_val_input" name="outro_esporte_val_input" class="dynamic-input" style="display: none;">
            </div>

            <fieldset id="avaliacao_resultados_fieldset" class="main-fieldset">
                <legend class="fieldset-legend-main">Avaliação de Resultados (Pós-Partida)</legend>
                <div class="sub-group">
                    <p class="question-title">Resultado Final da Operação</p>
                    <div class="options-container">
                        <div class="option-item"><input type="radio" id="resultado_green" name="resultado_final" value="Green" required><label for="resultado_green">Green</label></div>
                        <div class="option-item"><input type="radio" id="resultado_red" name="resultado_final" value="Red"><label for="resultado_red">Red</label></div>
                    </div>
                </div>
                <p style="color: #d4af37; font-style: italic; margin-top: -10px; margin-bottom: 20px;">Se o resultado for "Red", é recomendado detalhar a avaliação abaixo ou em "Outros/OBS".</p>
                
                <div class="sub-group">
                    <p class="question-title">1X2 (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_1x2_home" name="v_1x2_avaliacoes[]" value="Home"><label for="v_1x2_home">Home</label></div>
                        <div class="option-item"><input type="checkbox" id="v_1x2_away" name="v_1x2_avaliacoes[]" value="Away"><label for="v_1x2_away">Away</label></div>
                        <div class="option-item"><input type="checkbox" id="v_1x2_draw" name="v_1x2_avaliacoes[]" value="Draw"><label for="v_1x2_draw">Draw</label></div>
                        <div class="option-item"><input type="checkbox" id="v_1x2_hd" name="v_1x2_avaliacoes[]" value="Home&Draw"><label for="v_1x2_hd">Home&Draw</label></div>
                        <div class="option-item"><input type="checkbox" id="v_1x2_ad" name="v_1x2_avaliacoes[]" value="Away&Draw"><label for="v_1x2_ad">Away&Draw</label></div>
                    </div>
                </div>
                <div class="sub-group">
                    <p class="question-title">Gols (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_gols_totais" name="v_gols_avaliacoes[]" value="UO_Totais"><label for="v_gols_totais">U/O - Totais</label></div>
                        <div class="option-item"><input type="checkbox" id="v_gols_equipes" name="v_gols_avaliacoes[]" value="UO_Equipes"><label for="v_gols_equipes">U/O - Equipes</label></div>
                        <div class="option-item"><input type="checkbox" id="v_gols_totais_ht" name="v_gols_avaliacoes[]" value="UO_Totais_HT"><label for="v_gols_totais_ht">U/O - Totais - HT</label></div>
                        <div class="option-item"><input type="checkbox" id="v_gols_equipes_ht" name="v_gols_avaliacoes[]" value="UO_Equipes_HT"><label for="v_gols_equipes_ht">U/O - Equipes - HT</label></div>
                    </div>
                </div>
                <div class="sub-group">
                    <p class="question-title">Cartões (O que aconteceu?)</p>
                     <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_cartoes_totais" name="v_cartoes_avaliacoes[]" value="UO_Totais"><label for="v_cartoes_totais">U/O - Totais</label></div>
                        <div class="option-item"><input type="checkbox" id="v_cartoes_equipes" name="v_cartoes_avaliacoes[]" value="UO_Equipes"><label for="v_cartoes_equipes">U/O - Equipes</label></div>
                        <div class="option-item"><input type="checkbox" id="v_cartoes_totais_ht" name="v_cartoes_avaliacoes[]" value="UO_Totais_HT"><label for="v_cartoes_totais_ht">U/O - Totais - HT</label></div>
                        <div class="option-item"><input type="checkbox" id="v_cartoes_equipes_ht" name="v_cartoes_avaliacoes[]" value="UO_Equipes_HT"><label for="v_cartoes_equipes_ht">U/O - Equipes - HT</label></div>
                    </div>
                </div>
                <div class="sub-group">
                    <p class="question-title">Defesas de Goleiro (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_defesas_home" name="v_defesas_avaliacoes[]" value="Home"><label for="v_defesas_home">Home</label></div>
                        <div class="option-item"><input type="checkbox" id="v_defesas_away" name="v_defesas_avaliacoes[]" value="Away"><label for="v_defesas_away">Away</label></div>
                        <div class="option-item"><input type="checkbox" id="v_defesas_ha" name="v_defesas_avaliacoes[]" value="Home/Away"><label for="v_defesas_ha">Home/Away</label></div>
                    </div>
                </div>
                 <div class="sub-group">
                    <p class="question-title">Escanteios (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_escanteios_totais" name="v_escanteios_avaliacoes[]" value="UO_Totais"><label for="v_escanteios_totais">U/O - Totais</label></div>
                        <div class="option-item"><input type="checkbox" id="v_escanteios_equipes" name="v_escanteios_avaliacoes[]" value="UO_Equipes"><label for="v_escanteios_equipes">U/O - Equipes</label></div>
                        <div class="option-item"><input type="checkbox" id="v_escanteios_totais_ht" name="v_escanteios_avaliacoes[]" value="UO_Totais_HT"><label for="v_escanteios_totais_ht">U/O - Totais - HT</label></div>
                        <div class="option-item"><input type="checkbox" id="v_escanteios_equipes_ht" name="v_escanteios_avaliacoes[]" value="UO_Equipes_HT"><label for="v_escanteios_equipes_ht">U/O - Equipes - HT</label></div>
                    </div>
                </div>
                <div class="sub-group">
                    <p class="question-title">Finalizações (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_finalizacoes_totais" name="v_finalizacoes_avaliacoes[]" value="UO_Totais"><label for="v_finalizacoes_totais">U/O - Totais</label></div>
                        <div class="option-item"><input type="checkbox" id="v_finalizacoes_equipes" name="v_finalizacoes_avaliacoes[]" value="UO_Equipes"><label for="v_finalizacoes_equipes">U/O - Equipes</label></div>
                        <div class="option-item"><input type="checkbox" id="v_finalizacoes_totais_ht" name="v_finalizacoes_avaliacoes[]" value="UO_Totais_HT"><label for="v_finalizacoes_totais_ht">U/O - Totais - HT</label></div>
                        <div class="option-item"><input type="checkbox" id="v_finalizacoes_equipes_ht" name="v_finalizacoes_avaliacoes[]" value="UO_Equipes_HT"><label for="v_finalizacoes_equipes_ht">U/O - Equipes - HT</label></div>
                    </div>
                </div>
                <div class="sub-group">
                    <p class="question-title">Finalizações no Gol (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_f_gol_totais" name="v_f_gol_avaliacoes[]" value="UO_Totais"><label for="v_f_gol_totais">U/O - Totais</label></div>
                        <div class="option-item"><input type="checkbox" id="v_f_gol_equipes" name="v_f_gol_avaliacoes[]" value="UO_Equipes"><label for="v_f_gol_equipes">U/O - Equipes</label></div>
                        <div class="option-item"><input type="checkbox" id="v_f_gol_totais_ht" name="v_f_gol_avaliacoes[]" value="UO_Totais_HT"><label for="v_f_gol_totais_ht">U/O - Totais - HT</label></div>
                        <div class="option-item"><input type="checkbox" id="v_f_gol_equipes_ht" name="v_f_gol_avaliacoes[]" value="UO_Equipes_HT"><label for="v_f_gol_equipes_ht">U/O - Equipes - HT</label></div>
                    </div>
                </div>
                 <div class="sub-group">
                    <p class="question-title">Impedimentos (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_impedimentos_totais" name="v_impedimentos_avaliacoes[]" value="UO_Totais"><label for="v_impedimentos_totais">U/O - Totais</label></div>
                        <div class="option-item"><input type="checkbox" id="v_impedimentos_equipes" name="v_impedimentos_avaliacoes[]" value="UO_Equipes"><label for="v_impedimentos_equipes">U/O - Equipes</label></div>
                        <div class="option-item"><input type="checkbox" id="v_impedimentos_totais_ht" name="v_impedimentos_avaliacoes[]" value="UO_Totais_HT"><label for="v_impedimentos_totais_ht">U/O - Totais - HT</label></div>
                        <div class="option-item"><input type="checkbox" id="v_impedimentos_equipes_ht" name="v_impedimentos_avaliacoes[]" value="UO_Equipes_HT"><label for="v_impedimentos_equipes_ht">U/O - Equipes - HT</label></div>
                    </div>
                </div>
                <div class="sub-group">
                    <p class="question-title">Outros Mercados (O que aconteceu?)</p>
                    <div class="options-container">
                        <div class="option-item"><input type="checkbox" id="v_outros_ambos" name="v_outros_avaliacoes[]" value="ambos_marcam"><label for="v_outros_ambos">Ambos Marcam</label></div>
                        <div class="option-item"><input type="checkbox" id="v_outros_trave" name="v_outros_avaliacoes[]" value="bola_trave"><label for="v_outros_trave">Bola na Trave</label></div>
                        <div class="option-item"><input type="checkbox" id="v_outros_handicap" name="v_outros_avaliacoes[]" value="handicap"><label for="v_outros_handicap">Handicap</label></div>
                        <div class="option-item"><input type="checkbox" id="v_outros_ha" name="v_outros_avaliacoes[]" value="handicap_asiatico"><label for="v_outros_ha">Handicap Asiático</label></div>
                        <div class="option-item"><input type="checkbox" id="v_outros_penalti" name="v_outros_avaliacoes[]" value="penalti"><label for="v_outros_penalti">Pênalti</label></div>
                        <div class="option-item"><input type="checkbox" id="v_outros_jogador" name="v_outros_avaliacoes[]" value="especiais_jogador"><label for="v_outros_jogador">Especiais Jogador</label></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="validacao_avaliacao_obs">Outros/OBS (Avaliação de Resultados)</label>
                    <textarea id="validacao_avaliacao_obs" name="validacao_avaliacao_obs" rows="4"></textarea>
                </div>
            </fieldset>

            <fieldset id="revisao_operacao_fieldset" class="main-fieldset">
                <legend class="fieldset-legend-main">Revisão da Operação</legend>

                <div class="sub-group">
                    <p class="question-title">Operação bem-sucedida (Operacionalmente)?</p>
                    <div class="options-container">
                        <div class="option-item"><input type="radio" id="rev_op_sim" name="revisao_status_operacao" value="Sim" required><label for="rev_op_sim">Sim</label></div>
                        <div class="option-item"><input type="radio" id="rev_op_nao" name="revisao_status_operacao" value="Nao"><label for="rev_op_nao">Não</label></div>
                        <div class="option-item"><input type="radio" id="rev_op_canc_parte" name="revisao_status_operacao" value="Cancelada_Parte"><label for="rev_op_canc_parte">Cancelada - Parte</label></div>
                        <div class="option-item"><input type="radio" id="rev_op_canc_contra" name="revisao_status_operacao" value="Cancelada_Contraparte"><label for="rev_op_canc_contra">Cancelada - Contraparte</label></div>
                        <div class="option-item"><input type="radio" id="rev_op_devolvida" name="revisao_status_operacao" value="Devolvida"><label for="rev_op_devolvida">Devolvida</label></div>
                        <div class="option-item"><input type="radio" id="rev_op_parcial" name="revisao_status_operacao" value="Parcialmente"><label for="rev_op_parcial">Parcialmente</label></div>
                    </div>
                </div>

                <div class="sub-group">
                    <p class="question-title">Cash Out?</p>
                    <div class="options-container">
                        <div class="option-item"><input type="radio" id="rev_cashout_sim" name="revisao_cash_out" value="Sim" required><label for="rev_cashout_sim">Sim</label></div>
                        <div class="option-item"><input type="radio" id="rev_cashout_nao" name="revisao_cash_out" value="Nao"><label for="rev_cashout_nao">Não</label></div>
                    </div>
                </div>

                <div class="sub-group">
                    <p class="question-title">Cobertura (Hedge)?</p>
                    <div class="options-container">
                        <div class="option-item"><input type="radio" id="rev_cobertura_sim" name="revisao_cobertura" value="Sim" required><label for="rev_cobertura_sim">Sim</label></div>
                        <div class="option-item"><input type="radio" id="rev_cobertura_nao" name="revisao_cobertura" value="Nao"><label for="rev_cobertura_nao">Não</label></div>
                        <div class="option-item"><input type="radio" id="rev_cobertura_middle" name="revisao_cobertura" value="Middle"><label for="rev_cobertura_middle">Middle</label></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="revisao_retorno_odd">Retorno Alcançado (Odd Efetiva da Operação)</label>
                    <input type="number" id="revisao_retorno_odd" name="revisao_retorno_odd" step="0.01" required>
                </div>

                <div class="form-group">
                    <label for="revisao_nova_unidade">Nova Unidade (após esta operação, se alterada)</label>
                    <input type="number" id="revisao_nova_unidade" name="revisao_nova_unidade" step="0.1">
                </div>

                <div class="sub-group">
                    <p class="question-title">Operação Bem sucedida até o Fim da Partida?</p>
                    <div class="options-container">
                        <div class="option-item"><input type="radio" id="rev_op_ate_fim_sim" name="revisao_op_ate_fim" value="Sim" required><label for="rev_op_ate_fim_sim">Sim</label></div>
                        <div class="option-item"><input type="radio" id="rev_op_ate_fim_nao" name="revisao_op_ate_fim" value="Nao"><label for="rev_op_ate_fim_nao">Não</label></div>
                    </div>
                </div>

                <div class="sub-group">
                    <p class="question-title">Correspondência de Análise:</p>
                    
                    <div id="revisao_correspondencia_checkbox_container" class="options-container" style="flex-direction: column; align-items: flex-start; margin-bottom: 25px;">
                        <div class="option-item"><input type="checkbox" id="corresp_relatorio" name="revisao_correspondencia_predefinida[]" value="Relatório"><label for="corresp_relatorio">Relatório</label></div>
                        <div class="option-item"><input type="checkbox" id="corresp_analise_pessoal" name="revisao_correspondencia_predefinida[]" value="Análise Pessoal"><label for="corresp_analise_pessoal">Análise Pessoal</label></div>
                        <div class="option-item"><input type="checkbox" id="corresp_h2h" name="revisao_correspondencia_predefinida[]" value="H2H"><label for="corresp_h2h">H2H</label></div>
                    </div>

                    <div id="prognosticos-container">
                        <p class="question-title" style="font-size: 16px; color: #EAF9E1;">Prognósticos e Tips (sites de referência)</p>
                        
                        <div class="prognostico-item" data-site-name="Academia das Apostas"><strong class="prognostico-site-name">Academia das Apostas</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_acad_1X2" data-market="1X2"><label for="p_acad_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_acad_gols" data-market="Gols (+-1)"><label for="p_acad_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_acad_ambos" data-market="Ambos Marcam"><label for="p_acad_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="Eagle Predict"><strong class="prognostico-site-name">Eagle Predict</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_eag_1X2" data-market="1X2"><label for="p_eag_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_eag_gols" data-market="Gols (+-1)"><label for="p_eag_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_eag_ambos" data-market="Ambos Marcam"><label for="p_eag_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="FootyStats"><strong class="prognostico-site-name">FootyStats</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_foot_1X2" data-market="1X2"><label for="p_foot_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_foot_gols" data-market="Gols (+-1)"><label for="p_foot_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_foot_ambos" data-market="Ambos Marcam"><label for="p_foot_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="Forebet"><strong class="prognostico-site-name">Forebet</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_fore_1X2" data-market="1X2"><label for="p_fore_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_fore_gols" data-market="Gols (+-1)"><label for="p_fore_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_fore_ambos" data-market="Ambos Marcam"><label for="p_fore_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="KickOff UK"><strong class="prognostico-site-name">KickOff UK</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_kick_1X2" data-market="1X2"><label for="p_kick_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_kick_gols" data-market="Gols (+-1)"><label for="p_kick_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_kick_ambos" data-market="Ambos Marcam"><label for="p_kick_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="PredictZ"><strong class="prognostico-site-name">PredictZ</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_pred_1X2" data-market="1X2"><label for="p_pred_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_pred_gols" data-market="Gols (+-1)"><label for="p_pred_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_pred_ambos" data-market="Ambos Marcam"><label for="p_pred_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="RatingBet"><strong class="prognostico-site-name">RatingBet</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_rat_1X2" data-market="1X2"><label for="p_rat_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_rat_gols" data-market="Gols (+-1)"><label for="p_rat_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_rat_ambos" data-market="Ambos Marcam"><label for="p_rat_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="SportsMole"><strong class="prognostico-site-name">SportsMole</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_sm_1X2" data-market="1X2"><label for="p_sm_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_sm_gols" data-market="Gols (+-1)"><label for="p_sm_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_sm_ambos" data-market="Ambos Marcam"><label for="p_sm_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="Transfermarkt"><strong class="prognostico-site-name">Transfermarkt</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_tm_1X2" data-market="1X2"><label for="p_tm_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_tm_gols" data-market="Gols (+-1)"><label for="p_tm_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_tm_ambos" data-market="Ambos Marcam"><label for="p_tm_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="WinDrawWin"><strong class="prognostico-site-name">WinDrawWin</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_wdw_1X2" data-market="1X2"><label for="p_wdw_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_wdw_gols" data-market="Gols (+-1)"><label for="p_wdw_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_wdw_ambos" data-market="Ambos Marcam"><label for="p_wdw_ambos">Ambos Marcam</label></div></div></div>
                        <div class="prognostico-item" data-site-name="xGScore"><strong class="prognostico-site-name">xGScore</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_xgscore_1X2" data-market="1X2"><label for="p_xgscore_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_xgscore_gols" data-market="Gols (+-1)"><label for="p_xgscore_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_xgscore_ambos" data-market="Ambos Marcam"><label for="p_xgscore_ambos">Ambos Marcam</label></div></div></div>

                        <div class="prognostico-group-separator"></div>

                        <div class="prognostico-item" data-site-name="Acertador das Bets"><strong class="prognostico-site-name">Acertador das Bets</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_acert_1X2" data-market="1X2"><label for="p_acert_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_acert_gols" data-market="Gols (+-1)"><label for="p_acert_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_acert_fin" data-market="Finalizações"><label for="p_acert_fin">Finalizações</label></div><div class="option-item"><input type="checkbox" id="p_acert_esc" data-market="Escanteios"><label for="p_acert_esc">Escanteios</label></div></div></div>
                        <div class="prognostico-item" data-site-name="Arena dos Dados"><strong class="prognostico-site-name">Arena dos Dados</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_arena_1X2" data-market="1X2"><label for="p_arena_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_arena_gols" data-market="Gols (+-1)"><label for="p_arena_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_arena_fin" data-market="Finalizações"><label for="p_arena_fin">Finalizações</label></div><div class="option-item"><input type="checkbox" id="p_arena_esc" data-market="Escanteios"><label for="p_arena_esc">Escanteios</label></div></div></div>
                        <div class="prognostico-item" data-site-name="Bruxo"><strong class="prognostico-site-name">Bruxo</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_bruxo_1X2" data-market="1X2"><label for="p_bruxo_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_bruxo_gols" data-market="Gols (+-1)"><label for="p_bruxo_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_bruxo_fin" data-market="Finalizações"><label for="p_bruxo_fin">Finalizações</label></div><div class="option-item"><input type="checkbox" id="p_bruxo_esc" data-market="Escanteios"><label for="p_bruxo_esc">Escanteios</label></div></div></div>
                        <div class="prognostico-item" data-site-name="João da Info"><strong class="prognostico-site-name">João da Info</strong><div class="prognostico-options"><div class="option-item"><input type="checkbox" id="p_joao_1X2" data-market="1X2"><label for="p_joao_1X2">1X2</label></div><div class="option-item"><input type="checkbox" id="p_joao_gols" data-market="Gols (+-1)"><label for="p_joao_gols">Gols (+-1)</label></div><div class="option-item"><input type="checkbox" id="p_joao_fin" data-market="Finalizações"><label for="p_joao_fin">Finalizações</label></div><div class="option-item"><input type="checkbox" id="p_joao_esc" data-market="Escanteios"><label for="p_joao_esc">Escanteios</label></div></div></div>
                        
                        <div class="prognostico-item" id="prognostico_outros_item">
                            <input type="text" id="prognostico_outros_nome_input" class="prognostico-site-name-input" placeholder="Outro">
                            <div class="prognostico-options">
                                <div class="option-item"><input type="checkbox" id="p_outros_1X2_custom" data-market="1X2"><label for="p_outros_1X2_custom">1X2</label></div>
                                <div class="option-item"><input type="checkbox" id="p_outros_gols_custom" data-market="Gols (+-1)"><label for="p_outros_gols_custom">Gols (+-1)</label></div>
                                <div class="option-item"><input type="checkbox" id="p_outros_fin_custom" data-market="Finalizações"><label for="p_outros_fin_custom">Finalizações</label></div>
                                <div class="option-item"><input type="checkbox" id="p_outros_esc_custom" data-market="Escanteios"><label for="p_outros_esc_custom">Escanteios</label></div>
                            </div>
                        </div>
                    </div>
                    
                    <label for="revisao_correspondencia_outro_texto" style="margin-top:15px; display:block; font-weight:normal;">Outra Correspondência:</label>
                    <input type="text" id="revisao_correspondencia_outro_texto" name="revisao_correspondencia_outro_texto" class="dynamic-input">
                </div>

                <div id="analise_partida_container" class="sub-group">
                    <p class="question-title">Análise da Partida (selecione ao menos uma):</p>
                    <div class="options-container" style="flex-direction: column; align-items: flex-start;">
                        <div class="option-item"><input type="checkbox" id="ap_dentro_esperado" name="analise_partida_opcoes[]" value="Dentro do Esperado"><label for="ap_dentro_esperado">Dentro do Esperado</label></div>
                        <div class="option-item"><input type="checkbox" id="ap_under" name="analise_partida_opcoes[]" value="Under"><label for="ap_under">Under</label></div>
                        <div class="option-item"><input type="checkbox" id="ap_over" name="analise_partida_opcoes[]" value="Over"><label for="ap_over">Over</label></div>
                        <div class="option-item"><input type="checkbox" id="ap_truncada" name="analise_partida_opcoes[]" value="Truncada"><label for="ap_truncada">Truncada</label></div>
                        <div class="option-item"><input type="checkbox" id="ap_aberta" name="analise_partida_opcoes[]" value="Aberta"><label for="ap_aberta">Aberta</label></div>
                        <div class="option-item"><input type="checkbox" id="ap_zebra" name="analise_partida_opcoes[]" value="Zebra"><label for="ap_zebra">Zebra</label></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="revisao_texto">Revisão Detalhada da Operação</label>
                    <textarea id="revisao_texto" name="revisao_texto" rows="5" required></textarea>
                </div>

                <div class="form-group">
                    <label for="revisao_obs_final">Outros / OBS (Revisão)</label>
                    <textarea id="revisao_obs_final" name="revisao_obs_final" rows="3"></textarea>
                </div>
            </fieldset>
            
            <input type="hidden" id="resumo_prognosticos_hidden_input" name="resumo_prognosticos">
            <button type="submit" class="submit-button">Salvar Validação</button>
        </form>
        <div id="mensagemStatus"></div>
    </div>

    <script>
        function setupDynamicSelect(selectId, inputId, optionValueToTrigger, isNumeric, suffix) {
            const selectElement = document.getElementById(selectId);
            const inputElement = document.getElementById(inputId);
            if (!selectElement || !inputElement) { return; }

            const addNewOption = () => {
                if (inputElement.style.display !== 'block') { return; }
                let newText = inputElement.value.trim();
                if (newText) {
                    if (isNumeric && isNaN(newText)) {
                        alert("Por favor, insira um valor numérico.");
                        inputElement.focus();
                        return;
                    }
                    if (suffix) { newText += suffix; }

                    let optionExists = false;
                    for (let i = 0; i < selectElement.options.length; i++) {
                        if (selectElement.options[i].value.toLowerCase() === newText.toLowerCase()) {
                            selectElement.value = selectElement.options[i].value;
                            optionExists = true;
                            break;
                        }
                    }
                    if (!optionExists) {
                        const currentOptionTexts = [];
                        for (let i = 0; i < selectElement.options.length; i++) {
                            const opt = selectElement.options[i];
                            if (opt.value && opt.value !== optionValueToTrigger && !opt.disabled) {
                                currentOptionTexts.push(opt.textContent);
                            }
                        }
                        currentOptionTexts.push(newText);
                        // Ordenação já tratada em populateSelect
                        populateSelect(selectId, currentOptionTexts, false); 
                        selectElement.value = newText;
                    }
                    inputElement.value = '';
                    inputElement.style.display = 'none';
                    selectElement.dispatchEvent(new Event('change'));
                } else {
                    if (selectElement.value === optionValueToTrigger) {
                        inputElement.style.display = 'none';
                    }
                }
            };

            selectElement.addEventListener('change', function() {
                if (this.value === optionValueToTrigger) {
                    inputElement.style.display = 'block';
                    inputElement.value = '';
                    inputElement.focus();
                } else {
                    inputElement.style.display = 'none';
                    inputElement.value = '';
                }
            });
            inputElement.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.keyCode === 13) {
                    event.preventDefault();
                    addNewOption();
                }
            });
            inputElement.addEventListener('blur', function() {
                setTimeout(() => {
                    if (inputElement.style.display === 'block') {
                        addNewOption();
                    }
                }, 150);
            });
        }

        function populateSelect(selectId, optionsArray, clearExisting = true) {
            const selectElement = document.getElementById(selectId);
            if (!selectElement) return;
            const otherOption = selectElement.querySelector('option[value^="outro_"]');
            const placeholderOption = selectElement.options[0];
            
            if(clearExisting){
                const keepValues = [];
                if(placeholderOption) keepValues.push(placeholderOption.value);
                if(otherOption) keepValues.push(otherOption.value);

                for (let i = selectElement.options.length - 1; i >= 0; i--) {
                    if (!keepValues.includes(selectElement.options[i].value)) {
                        selectElement.remove(i);
                    }
                }
            }

            let finalOptions = Array.isArray(optionsArray) ? [...new Set(optionsArray)] : []; // Usa Set para garantir valores únicos
             if (selectId === 'referencia_select' || selectId === 'referencia_realizacao_select') {
                finalOptions.sort((a, b) => {
                    const numA = parseInt(String(a).replace(/[^0-9]/g, ''), 10);
                    const numB = parseInt(String(b).replace(/[^0-9]/g, ''), 10);
                    if (!isNaN(numA) && !isNaN(numB)) { return numB - numA; }
                    if (!isNaN(numB)) return 1;
                    if (!isNaN(numA)) return -1;
                    return String(b).localeCompare(String(a));
                });
            } else {
                finalOptions.sort((a, b) => String(a).localeCompare(String(b)));
            }
            
            finalOptions.forEach(optionText => {
                if (optionText === null || optionText === undefined || String(optionText).trim() === "") return;
                let optionExists = false;
                for(let k=0; k < selectElement.options.length; k++) {
                    if(selectElement.options[k].value === String(optionText)) { optionExists = true; break; }
                }
                if(optionExists) return;

                const option = document.createElement('option');
                option.value = optionText;
                option.textContent = optionText;
                if (otherOption) {
                    selectElement.insertBefore(option, otherOption);
                } else {
                    selectElement.appendChild(option);
                }
            });
        }

        function populateCheckboxGroup(containerId, checkboxName, optionsArray) {
            const container = document.getElementById(containerId);
            if (!container) return;
            let sortedOptions = Array.isArray(optionsArray) ? [...new Set(optionsArray)] : []; // Unicos e ordenados
            sortedOptions.sort((a, b) => String(a).localeCompare(String(b)));
            
            const initialCheckboxesValues = ['Relatório', 'Análise Pessoal', 'H2H'];
            
            container.querySelectorAll('.option-item input[type="checkbox"]').forEach(cb => {
                if (!initialCheckboxesValues.includes(cb.value)){
                   cb.closest('.option-item').remove();
                }
            });

            sortedOptions.forEach(optionText => {
                if (optionText === null || optionText === undefined || String(optionText).trim() === "" || initialCheckboxesValues.includes(optionText)) return;
                if (container.querySelector(`input[type="checkbox"][value="${optionText}"]`)) return;

                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-item';
                const checkboxInput = document.createElement('input');
                checkboxInput.type = 'checkbox';
                // Gera IDs únicos para os checkboxes dinâmicos
                const checkboxId = checkboxName.replace('[]','') + '_' + String(optionText).replace(/\s+/g, '_').replace(/[^\w-]/gi, '').toLowerCase();
                checkboxInput.id = checkboxId;
                checkboxInput.name = checkboxName; 
                checkboxInput.value = optionText;
                const checkboxLabel = document.createElement('label');
                checkboxLabel.htmlFor = checkboxInput.id;
                checkboxLabel.textContent = optionText;
                optionDiv.appendChild(checkboxInput);
                optionDiv.appendChild(checkboxLabel);
                container.appendChild(optionDiv);
            });
        }

        function aggregatePrognostics() {
            const results = [];
            const prognosticItems = document.querySelectorAll('.prognostico-item');

            prognosticItems.forEach(item => {
                let siteName = '';
                if (item.id === 'prognostico_outros_item') {
                    const customNameInput = item.querySelector('#prognostico_outros_nome_input');
                    if (customNameInput) {
                        siteName = customNameInput.value.trim();
                    }
                    if (!siteName) { 
                         const anyMarketCheckedForOutros = item.querySelector('input[type="checkbox"]:checked');
                         if (!anyMarketCheckedForOutros) {
                            return; 
                         }
                         siteName = "Outro (Não Especificado)"; // Nome default se mercados marcados mas sem nome
                    }
                } else {
                    siteName = item.dataset.siteName;
                }

                if (!siteName) return; 

                const checkedMarkets = [];
                item.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                    checkedMarkets.push(checkbox.dataset.market);
                });

                if (checkedMarkets.length > 0) {
                    const marketsString = checkedMarkets.join(', ');
                    results.push(`${siteName}: (${marketsString})`);
                }
            });

            const finalString = results.join('; ');
            const hiddenInput = document.getElementById('resumo_prognosticos_hidden_input');
            if (hiddenInput) {
                hiddenInput.value = finalString;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetch("https://script.google.com/macros/s/AKfycbzMohuS0VcT2_f5f-gU4h-8-ADFknbYvvdlODFNyKIWhSzgYVTYM8drqOhJZodiSQRB/exec")
                .then(response => response.json())
                .then(data => {
                    if (data.error) { console.error("Erro ao buscar listas:", data.error); return; }
                    if (data.Estrategias) populateSelect('estrategia_select_val', data.Estrategias);
                    if (data.Esportes) populateSelect('esporte_select_val', data.Esportes);
                    if (data.Referencias) populateSelect('referencia_realizacao_select', data.Referencias);
                    if (data.CorrespondenciaItens) {
                        populateCheckboxGroup(
                            'revisao_correspondencia_checkbox_container', 
                            'revisao_correspondencia_predefinida[]', 
                            data.CorrespondenciaItens
                        );
                    }
                    console.log("Listas dinâmicas para Validação carregadas.");
                })
                .catch(error => { console.error('Erro ao carregar listas dinâmicas:', error); });

            setupDynamicSelect('estrategia_select_val', 'outra_estrategia_val_input', 'outro_estrategia_val');
            setupDynamicSelect('esporte_select_val', 'outro_esporte_val_input', 'outro_esporte_val');
            setupDynamicSelect('referencia_realizacao_select', 'outra_referencia_realizacao_input', 'outro_referencia_realizacao');
            
            const form = document.getElementById('validacaoForm');
            const mensagemStatus = document.getElementById('mensagemStatus');
            const resultadoRedRadio = document.getElementById('resultado_red');
            const avaliacaoFieldset = document.getElementById('avaliacao_resultados_fieldset');
            const obsTextareaAvaliacao = document.getElementById('validacao_avaliacao_obs');
            const analisePartidaContainer = document.getElementById('analise_partida_container');
            
            if (form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    aggregatePrognostics(); 

                    if (resultadoRedRadio && resultadoRedRadio.checked) {
                        if (avaliacaoFieldset) {
                            const subitemCheckboxesAvaliacao = avaliacaoFieldset.querySelectorAll('.sub-group input[type="checkbox"]:checked');
                            const obsAvaliacaoIsFilled = obsTextareaAvaliacao && obsTextareaAvaliacao.value.trim() !== '';
                            if (subitemCheckboxesAvaliacao.length === 0 && !obsAvaliacaoIsFilled) {
                                alert('Se o resultado for "Red", deve selecionar ao menos uma opção nos subitens de "Avaliação de Resultados" ou preencher "Outros/OBS" da mesma seção.');
                                avaliacaoFieldset.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                return;
                            }
                        }
                    }
                    if (analisePartidaContainer) {
                        const analisePartidaCheckboxes = analisePartidaContainer.querySelectorAll('input[type="checkbox"]:checked');
                        if (analisePartidaCheckboxes.length === 0) {
                            alert("Por favor, selecione ao menos uma opção em 'Análise da Partida'.");
                            analisePartidaContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            return; 
                        }
                    }

                    form.style.display = 'none';
                    mensagemStatus.textContent = 'Salvando validação, por favor aguarde';
                    mensagemStatus.className = 'sucesso';
                    mensagemStatus.style.display = 'block';

                    const dadosDoFormulario = new FormData(form);
                    
                    fetch(form.action, {
                        method: 'POST',
                        body: dadosDoFormulario,
                    })
                    .then(response => response.json())
                    .then(data => {
                        if(data.status === 'success'){
                            mensagemStatus.textContent = 'Validação salva com sucesso! Redirecionando para a página inicial';
                            mensagemStatus.className = 'sucesso';
                            setTimeout(() => { window.location.href = 'index.html'; }, 2500);
                        } else {
                            throw new Error(data.message || 'Erro desconhecido do servidor.');
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao enviar o formulário:', error);
                        mensagemStatus.textContent = 'Ocorreu um erro ao salvar: ' + error.message;
                        mensagemStatus.className = 'erro';
                        form.style.display = 'block'; 
                    });
                });
            }
        });
    </script>
</body>
</html>
